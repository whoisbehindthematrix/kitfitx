// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}



model User {
  id             String       @id @default(cuid())
  email          String?      @unique
  displayName    String?
  avatarUrl      String?
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  role           Role         @default(USER)


  profile              UserProfile?
  cycleEntries         CycleEntry[]
  predictions          PredictionData[]
  quickNotes           QuickNote[]
  onboarding           Onboarding?
  onboardingQuestions  OnboardingQuestions?
}

// ===========================================
// USER PROFILE
// ===========================================
model UserProfile {
  id                    String   @id @default(cuid())
  userId                String   @unique
  user                  User     @relation(fields: [userId], references: [id])
  
  fullName              String?
  dateOfBirth           DateTime?
  gender                String?
  timezone              String?
  
  averageCycleLength     Int      @default(28)
  periodDuration         Int      @default(5)
  lutealPhaseDays        Int      @default(14)
  lastPeriodStart        DateTime?
  menopauseStatus        String?  // "pre" | "peri" | "post" menopauseStatus is a medical lifecycle indicator for women.
  
  wellnessGoals          String[] @default([])
  dailyCalorieGoal       Int?
  activityLevel          String?
  height                 Float?
  weight                 Float?
  targetWeight           Float?
  unitsSystem            String?  // "metric" | "imperial"
  
  theme                  String?  // "light" | "dark" | "auto"
  notifications          Json?
  language               String?
  
  onboardingCompleted    Boolean  @default(false)
  
  createdAt              DateTime @default(now())
  updatedAt              DateTime @updatedAt
  lastSyncedAt           DateTime?
  appVersion             String?
}

// ===========================================
// CYCLE ENTRIES (Daily logs)
// ===========================================
model CycleEntry {
  id             String     @id @default(cuid())
  userId         String
  user           User       @relation(fields: [userId], references: [id])
  
  date           DateTime
  isPeriod       Boolean
  flowIntensity  String?     // light | medium | heavy | spotting
  symptoms       Json?
  notes          String?
}

// ===========================================
// PREDICTIONS (Generated insights)
// ===========================================
model PredictionData {
  id            String     @id @default(cuid())
  userId        String
  user          User       @relation(fields: [userId], references: [id])

  nextPeriod    DateTime?
  ovulation     DateTime?
  fertileWindow Json?       // { start, peak, end, confidence }
  analytics     Json?
  
  createdAt     DateTime   @default(now())
}

// ===========================================
// QUICK NOTES (User quick notes)
// ===========================================
model QuickNote {
  id            String     @id @default(cuid())
  userId        String
  user          User       @relation(fields: [userId], references: [id])

  date          DateTime
  title         String
  icon          String
  text          String?
  reminder      Boolean    @default(false)
  reminderTime  String?    // Time string (HH:mm format)
  
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt

  @@index([userId, date])
}


// ===========================================
// ONBOARDING (Basic Profile Information)
// ===========================================
model Onboarding {
  id                  String    @id @default(cuid())
  userId              String    @unique
  user                User      @relation(fields: [userId], references: [id])
  
  // Profile Information
  dateOfBirth         DateTime?
  
  // Physical Measurements
  weight              Float?    // Actual weight value
  height              Float?    // Actual height value
  targetWeight        Float?
  unitsSystem         String?   // "metric" | "imperial"
  
  // Nutrition
  dailyCalorieGoal    Int?
  
  // Cycle Information (REQUIRED)
  averageCycleLength  Int       @default(28)
  periodDuration      Int       @default(5)
  
  // Metadata
  isCompleted         Boolean   @default(false)
  completedAt         DateTime?
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt
  
  @@index([userId])
}

// ===========================================
// ONBOARDING QUESTIONS (Questionnaire)
// ===========================================
model OnboardingQuestions {
  id                  String    @id @default(cuid())
  userId              String    @unique
  user                User      @relation(fields: [userId], references: [id])
  
  // Health & Reproductive
  reproductiveStage   String?
  healthGoal          String?
  
  // Birth Control
  birthControl        String[]  @default([])
  
  // Medical & Symptoms
  medicalDiagnoses    String[]  @default([])
  physicalSymptoms    String[]  @default([])  // max 3 items
  
  // Mood & Stress
  pmsMood             String?
  stressLevel         String?
  
  // Nutrition
  foodStruggles       String[]  @default([])
  dietaryLifestyle     String?
  
  // Metadata
  isCompleted         Boolean   @default(false)
  completedAt         DateTime?
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt
  
  @@index([userId])
}

enum Role {
  USER
  ADMIN
}